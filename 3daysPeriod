var CalendarId = "xxxx0@group.calendar.google.com";
var telegramToken = "xxx";
var chatId = "xxx";

function dailyEventMessage() {
  let msg = "";
  for (let i = 1; i <= 3; i++) {
    let d = new Date();
    d.setDate(d.getDate() + i);
    let dateStr = d.toLocaleDateString("th-TH", { weekday: "long", day: "numeric", month: "long", year: "numeric" });
    let label = ["", "‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ", "‡∏°‡∏∞‡∏£‡∏∑‡∏ô‡∏ô‡∏µ‡πâ", "‡∏≠‡∏µ‡∏Å 3 ‡∏ß‡∏±‡∏ô"][i];
    let events = CalendarApp.getCalendarById(CalendarId).getEventsForDay(d);
    msg += `üì£ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à *${label}* \n(${dateStr})\n`;
    if (events.length == 0) {
      msg += `‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°\n\n`;
      continue;
    }
    msg += `üî∂ ‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${events.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n`;
    events.forEach((e, idx) => {
      msg += `\n${idx + 1}. üìÅ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á : ${e.getTitle()}\n   ‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤ : ${e.getStartTime().toTimeString().slice(0,5)} - ${e.getEndTime().toTimeString().slice(0,5)}\n   üìç ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î : ${e.getDescription() || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}`;
    });
    msg += "\n\n";
  }
  sendTelegram(msg.trim());
}

function sendTelegram(msg) {
  UrlFetchApp.fetch(`https://api.telegram.org/bot${telegramToken}/sendMessage`, {
    method: 'post',
    contentType: 'application/json',
    payload: JSON.stringify({ chat_id: chatId, text: msg, parse_mode: 'Markdown' })
  });
}
